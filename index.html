<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Growfax.shop — Role Shop & Wallet (Simulated)</title>
<style>
:root{
  --bg1:#07120b; --accent:#00ffe0; --muted:#9fcdbf; --card:#0f1512;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter, Poppins, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background: linear-gradient(180deg,#07120b 0%, #081f17 60%, #04100c 100%);
  color:#e9fff6; -webkit-font-smoothing:antialiased;
  min-height:100vh; display:flex; flex-direction:column; align-items:center;
}

/* Header */
.header{
  width:100%; max-width:1200px; padding:18px; display:flex; align-items:center; justify-content:space-between;
}
.brand{display:flex; gap:14px; align-items:center}
.brand img{height:58px; border-radius:10px; box-shadow:0 12px 40px rgba(0,255,224,0.06)}
.brand h1{margin:0; color:var(--accent); font-size:1.2rem; text-shadow:0 0 8px rgba(0,255,224,0.08)}
.wallet{display:flex; gap:10px; align-items:center}
.balance{background:rgba(255,255,255,0.03); padding:8px 12px; border-radius:10px; color:var(--accent); font-weight:700}
.topup-btn{background:linear-gradient(90deg,var(--accent),#0077ff); padding:8px 12px; border-radius:10px; color:#022; font-weight:800; border:none; cursor:pointer}

/* Main container */
.container{width:100%; max-width:1200px; padding:12px 18px 80px 18px}

/* Hero */
.hero{display:flex; flex-direction:column; align-items:center; gap:8px}
.banner{width:92%; max-width:760px; border-radius:14px; box-shadow:0 14px 50px rgba(0,255,224,0.04)}

/* Sections */
.section{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25)); border-radius:12px; padding:20px; margin:22px 0; box-shadow:0 8px 30px rgba(0,0,0,0.35)}
.section h2{margin:0 0 12px 0; color:var(--accent); text-shadow:0 0 8px rgba(0,255,224,0.06)}

/* Grid cards */
.grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px}
.card{background:#0b1210; padding:14px; border-radius:10px; min-height:120px; display:flex; flex-direction:column; justify-content:space-between; box-shadow:0 8px 24px rgba(0,0,0,0.45)}
.card h3{margin:0;color:var(--accent)}
.card p{margin:6px 0 0 0; color:#d6efe6}

/* Buttons */
.btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(90deg,var(--accent),#0077ff); color:#022; background-size:300% 300%; animation:rgbflow 5s linear infinite}
.btn-ghost{background:rgba(255,255,255,0.03); color:#dff7ee; border:1px solid rgba(255,255,255,0.04)}
.btn-copy{background:#0f0f0f;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}

/* Modal */
.modal-back{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); backdrop-filter:blur(8px); z-index:1200; align-items:center; justify-content:center}
.modal{width:92%; max-width:560px; background:#07110f; border-radius:12px; padding:18px; box-shadow:0 18px 60px rgba(0,0,0,0.6); position:relative}
.close-x{position:absolute; right:14px; top:10px; cursor:pointer; color:#9fcdbf; font-weight:700}

/* admin table */
.table-wrap{overflow:auto; max-height:56vh; border-radius:8px; background:#060706; padding:8px}
.table{width:100%; border-collapse:collapse; color:#e9fff6}
.table th{position:sticky; top:0; background:rgba(0,0,0,0.25); color:var(--accent); padding:10px; text-align:left}
.table td{padding:8px;border-bottom:1px solid rgba(0,255,224,0.03)}

/* history */
.history-list{display:flex; flex-direction:column; gap:8px}
.history-item{background:#081312;padding:10px;border-radius:8px;color:#dff7ee}

/* small */
.note{color:#bcd9d0;font-size:.95rem}
.footer{width:100%; padding:12px 18px; text-align:center; color:#8fbfb0; position:fixed; bottom:8px; left:0; right:0}

/* animations */
@keyframes rgbflow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@media(max-width:640px){ .header{flex-direction:column; gap:12px} .banner{width:96%} }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="brand">
    <img src="https://vivj-cosr.github.io/growfax.shop/Growfax_banner.png" alt="Growfax Banner" />
    <div>
      <h1>Growfax.shop</h1>
      <div style="font-size:0.86rem;color:var(--muted)">Official role shop — simulated wallet</div>
    </div>
  </div>

  <div class="wallet">
    <div class="balance" id="balanceDisplay">Rp 0</div>
    <button class="topup-btn" id="btnOpenTopup">Top-Up</button>
  </div>
</div>

<!-- MAIN -->
<div class="container">
  <div class="hero">
    <img class="banner" src="https://vivj-cosr.github.io/growfax.shop/Growfax_banner.png" alt="Banner">
    <div style="max-width:900px;color:#cfeee5">Top-up terlebih dahulu (minimal sesuai aturan) lalu beli role. Setelah klik "Mark as Paid" di top-up, saldo akan bertambah secara simulasi di browser. Semua transaksi akan mengirim notifikasi ke Discord untuk verifikasi admin.</div>
  </div>

  <!-- ROLES -->
  <section class="section">
    <h2>Available Roles</h2>
    <div class="grid" id="rolesGrid"></div>
    <div style="margin-top:12px" class="note">Saldo bersifat lokal (disimpan di browser). Admin akan memverifikasi pembayaran melalui channel Discord.</div>
  </section>

  <!-- HISTORY -->
  <section class="section">
    <h2>Riwayat Transaksi (Local)</h2>
    <div id="historyList" class="history-list"></div>
  </section>
</div>

<!-- FOOTER -->
<div class="footer">
  © 2025 VivJ — Powered by Growfax • <span style="cursor:pointer;text-decoration:underline" id="openAdmin">Admin</span>
</div>

<!-- MODAL: TOP-UP -->
<div class="modal-back" id="modalTopup">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="close-x" onclick="closeTopup()">✖</div>
    <h3>Top-up Balance</h3>
    <div class="note">Minimal top-up: > harga VIP (Rp <span id="vipPriceText">25.000</span>) — DANA percobaan minimal Rp 50.</div>

    <label style="display:block;text-align:left;margin-top:12px">Nominal (IDR)</label>
    <input id="topupAmount" type="number" placeholder="Masukkan nominal (contoh: 30000)" min="1" />

    <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
      <button class="btn btn-primary" onclick="selectTopupMethod('PayPal')">PayPal</button>
      <button class="btn btn-ghost" onclick="selectTopupMethod('BNI')">BNI Transfer</button>
      <button class="btn btn-ghost" onclick="selectTopupMethod('DANA')">DANA</button>
    </div>

    <!-- method specific -->
    <div id="topupInfo" style="margin-top:12px"></div>

    <div style="margin-top:12px; display:flex; gap:8px; justify-content:center;">
      <button id="btnMarkTopup" class="btn btn-primary" style="display:none" onclick="markTopupPaid()">Mark as Paid</button>
      <button class="btn btn-ghost" onclick="closeTopup()">Cancel</button>
    </div>
  </div>
</div>

<!-- MODAL: BUY -->
<div class="modal-back" id="modalBuy">
  <div class="modal">
    <div class="close-x" onclick="closeBuy()">✖</div>
    <h3 id="buyTitle">Purchase Role</h3>
    <div id="buyPrice" style="margin-top:6px;color:#bfeee6"></div>

    <label style="display:block;text-align:left;margin-top:12px">Nama (GrowID / Discord)</label>
    <input id="buyName" type="text" placeholder="Masukkan nama Anda" />

    <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
      <button class="btn btn-primary" onclick="confirmPurchase()">Use Balance & Confirm</button>
      <button class="btn btn-ghost" onclick="closeBuy()">Cancel</button>
    </div>
    <div class="note" style="margin-top:10px">Jika saldo tidak mencukupi, Anda akan diarahkan ke top-up.</div>
  </div>
</div>

<!-- MODAL: ADMIN -->
<div class="modal-back" id="modalAdmin">
  <div class="modal" style="max-width:980px">
    <div class="close-x" onclick="closeAdmin()">✖</div>
    <h3>Admin Panel — Purchase & Topup Log</h3>
    <div class="note">Password diperlukan untuk akses.</div>

    <div style="margin-top:12px" class="table-wrap">
      <table class="table" id="adminTable">
        <thead><tr><th>Type</th><th>User</th><th>Item/Note</th><th>Amount</th><th>Method</th><th>Time</th></tr></thead>
        <tbody id="adminTBody"></tbody>
      </table>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
      <button class="btn btn-primary" onclick="exportLogs()">Export JSON</button>
      <button class="btn btn-ghost" onclick="clearLogs()">Clear Local Logs</button>
      <button class="btn btn-ghost" onclick="closeAdmin()">Close</button>
    </div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const VIP_PRICE = 25000;
const ROLES = [
  {id:1, name:"VIP", price:25000},
  {id:2, name:"VIP+", price:50000},
  {id:3, name:"Moderator", price:100000},
  {id:4, name:"Super Moderator", price:200000},
  {id:5, name:"Developer", price:400000},
  {id:6, name:"God", price:600000},
  {id:7, name:"God [MAX]", price:1000000}
];
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1433382270886219817/JVLQ4Ei1IB94vMiEgowjOhmL_OkPcotKesB6mEsjjPKYdRnuVhoo_PgsWrWGkYyHkjk5";
const ADMIN_PASSWORD = "azzahran111";
const PAYPAL_LINK = "https://paypal.me/BilzXd1";
const BNI_ACCOUNT = "1949656911 (a.n. VivJ)";
const DANA_ACCOUNT = "0895338912670 (a.n. Azz)";
const DANA_MIN = 50; // minimal for DANA percobaan (Rp 50)

/* ================= UTILITIES ================= */
const $ = id => document.getElementById(id);
function fmt(n){ return "Rp " + Number(n).toLocaleString('id-ID'); }
function now(){ return new Date().toLocaleString(); }

/* ================= STORAGE HELPERS ================= */
function getBalance(){ return Number(localStorage.getItem("gw_balance") || 0); }
function setBalance(v){ localStorage.setItem("gw_balance", Math.max(0, Math.round(v))); updateBalanceUI(); }
function pushLog(entry){
  const logs = JSON.parse(localStorage.getItem("gw_logs")|| "[]");
  logs.push(entry);
  localStorage.setItem("gw_logs", JSON.stringify(logs));
  renderHistory();
}
function getLogs(){ return JSON.parse(localStorage.getItem("gw_logs")|| "[]"); }
function updateBalanceUI(){ $("balanceDisplay").innerText = fmt(getBalance()); }

/* ================= RENDER ROLES & HISTORY ================= */
function renderRoles(){
  const grid = $("rolesGrid");
  grid.innerHTML = "";
  ROLES.forEach(r=>{
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<div><h3>${r.name}</h3><p>${fmt(r.price)}</p></div>
      <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
        <button class="btn btn-primary" onclick="openBuy(${r.id})">Buy</button>
        <div style="font-size:0.82rem;color:var(--muted)">ID:${r.id}</div>
      </div>`;
    grid.appendChild(card);
  });
}

function renderHistory(){
  const list = $("historyList");
  const logs = getLogs().slice().reverse();
  list.innerHTML = "";
  if(!logs.length){ list.innerHTML = '<div class="note">Belum ada transaksi.</div>'; return; }
  logs.forEach(l=>{
    const el = document.createElement("div");
    el.className = "history-item";
    el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${l.type.toUpperCase()}</strong> • ${l.user || '—'}</div><div style="font-weight:700">${fmt(l.amount||0)}</div></div>
      <div style="margin-top:6px;color:#bfeee6">${l.item || l.note || '-'}</div>
      <div style="margin-top:6px;color:#98d9c3;font-size:0.9rem">${l.method || '-'} • ${l.time || now()}</div>`;
    list.appendChild(el);
  });
}

/* ================= TOP-UP FLOW ================= */
$("btnOpenTopup").addEventListener("click", openTopup);

function openTopup(){
  $("topupAmount").value = VIP_PRICE + 1000;
  $("topupInfo").innerHTML = "";
  $("btnMarkTopup").style.display = "none";
  $("modalTopup").style.display = "flex";
}
function closeTopup(){ $("modalTopup").style.display = "none"; }

function selectTopupMethod(method){
  const amt = Number($("topupAmount").value || 0);
  if(method === "DANA"){
    $("topupInfo").innerHTML = `<div style="background:#07120b;padding:10px;border-radius:8px">
      <div style="font-weight:700;color:var(--accent)">DANA — ${DANA_ACCOUNT}</div>
      <div style="color:#cfeee5;font-size:0.95rem;margin-top:6px">Minimal Rp ${DANA_MIN} (percobaan)</div>
      <div style="margin-top:8px"><button class="btn-copy" onclick="copyText('${DANA_ACCOUNT}')">Copy DANA</button></div>
    </div>`;
    if(amt < DANA_MIN){ $("btnMarkTopup").style.display = "inline-block"; }
  } else if(method === "BNI"){
    if(amt <= VIP_PRICE){ alert("BNI top-up minimal harus lebih dari harga VIP: " + fmt(VIP_PRICE)); return; }
    $("topupInfo").innerHTML = `<div style="background:#07120b;padding:10px;border-radius:8px">
      <div style="font-weight:700;color:var(--accent)">BNI — ${BNI_ACCOUNT}</div>
      <div style="margin-top:8px"><button class="btn-copy" onclick="copyText('${BNI_ACCOUNT}')">Copy BNI</button></div>
    </div>`;
  } else if(method === "PayPal"){
    if(amt <= VIP_PRICE){ alert("PayPal top-up minimal harus lebih dari harga VIP: " + fmt(VIP_PRICE)); return; }
    $("topupInfo").innerHTML = `<div style="background:#07120b;padding:10px;border-radius:8px">
      <div style="font-weight:700;color:var(--accent)">PayPal — ${PAYPAL_LINK}</div>
      <div style="margin-top:8px"><button class="btn btn-primary" onclick="window.open('${PAYPAL_LINK}','_blank')">Open PayPal</button></div>
    </div>`;
  }
  $("btnMarkTopup").style.display = "inline-block";
  // store selected method on element for mark action
  $("btnMarkTopup").dataset.method = method;
}

async function markTopupPaid(){
  const amt = Number($("topupAmount").value || 0);
  const method = $("btnMarkTopup").dataset.method || "BNI";
  if(method === "DANA" && amt < DANA_MIN){ alert("Minimal top-up untuk DANA adalah Rp " + DANA_MIN); return; }
  if((method === "BNI" || method === "PayPal") && amt <= VIP_PRICE){ alert("Top-up minimal untuk BNI/PayPal harus lebih dari VIP: " + fmt(VIP_PRICE)); return; }
  if(!amt || amt <= 0){ alert("Masukkan nominal valid."); return; }

  // simulate adding balance
  const prev = getBalance();
  setBalance(prev + amt);

  // push log
  const log = {type:"topup", user: "Unknown", item: "Top-up", amount: amt, method: method, time: now()};
  pushLog(log);

  // notify discord
  try{
    await fetch(DISCORD_WEBHOOK, {method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({content:`📥 **Top-Up**\nAmount: ${fmt(amt)}\nMethod: ${method}\nTime: ${log.time}`})});
  }catch(e){ console.warn("Webhook send failed", e); }

  alert("Top-up marked as paid (simulated). Saldo telah bertambah: " + fmt(amt));
  closeTopup();
}

/* ================= BUY FLOW ================= */
let currentRole = null;
function openBuy(roleId){
  const r = ROLES.find(x=>x.id === roleId);
  if(!r) return;
  currentRole = r;
  $("buyTitle").innerText = `Purchase — ${r.name}`;
  $("buyPrice").innerText = fmt(r.price);
  $("buyName").value = "";
  $("modalBuy").style.display = "flex";
}
function closeBuy(){ $("modalBuy").style.display = "none"; }

async function confirmPurchase(){
  const user = $("buyName").value.trim() || "Unknown";
  if(!currentRole) return;
  const bal = getBalance();
  if(bal < currentRole.price){
    alert("Saldo tidak cukup. Silakan top-up terlebih dahulu.");
    closeBuy();
    openTopup();
    return;
  }
  setBalance(bal - currentRole.price);
  const log = {type:"purchase", user:user, item: currentRole.name, amount: currentRole.price, method:"Balance", time: now()};
  pushLog(log);

  // discord notify
  try{
    await fetch(DISCORD_WEBHOOK, {method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({content:`📢 **New Role Purchase**\nUser: ${user}\nRole: ${currentRole.name}\nAmount: ${fmt(currentRole.price)}\nTime: ${log.time}`})});
  }catch(e){ console.warn("Webhook failed", e); }

  alert("Pembelian berhasil (simulasi). Admin akan verifikasi dan memberikan role di game.");
  closeBuy();
}

/* ================= ADMIN ================= */
document.getElementById("openAdmin").addEventListener("click", openAdmin);

function openAdmin(){
  const pw = prompt("Masukkan password admin:");
  if(pw !== ADMIN_PASSWORD){ alert("Password salah."); return; }
  fillAdminTable();
  $("modalAdmin").style.display = "flex";
}

function fillAdminTable(){
  const tbody = $("adminTBody");
  tbody.innerHTML = "";
  const logs = getLogs().slice().reverse();
  logs.forEach(l=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td style="padding:8px">${l.type}</td>
      <td style="padding:8px">${l.user || '-'}</td>
      <td style="padding:8px">${l.item || l.note || '-'}</td>
      <td style="padding:8px">${fmt(l.amount || 0)}</td>
      <td style="padding:8px">${l.method || '-'}</td>
      <td style="padding:8px">${l.time || '-'}</td>`;
    tbody.appendChild(tr);
  });
}

/* ================= UTILITIES & INIT ================= */
function copyText(txt){ navigator.clipboard.writeText(txt).then(()=>alert("Copied: " + txt)).catch(()=>alert("Failed to copy"));}
function exportLogs(){
  const blob = new Blob([JSON.stringify(getLogs(), null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url; a.download = "growfax_logs.json"; a.click(); URL.revokeObjectURL(url);
}
function clearLogs(){ if(!confirm("Hapus semua log lokal dan reset saldo?")) return; localStorage.removeItem("gw_logs"); setBalance(0); renderHistory(); fillAdminTable(); alert("Cleared."); }
function closeAdmin(){ $("modalAdmin").style.display = "none"; }

function openBuyUI(roleId){
  openBuy(roleId);
}

/* open buy by id via click events (render) */
function setupRoleButtons(){
  // create buttons dynamically in renderRoles, but need click hookup: done in renderRoles via onclick attribute
}

/* helper close modals when clicking outside */
window.onclick = function(e){
  if(e.target === $("modalTopup")) closeTopup();
  if(e.target === $("modalBuy")) closeBuy();
  if(e.target === $("modalAdmin")) closeAdmin();
};

/* init */
updateBalanceUI();
renderRoles();
renderHistory();
</script>

<!-- generate role buttons dynamically after script loaded -->
<script>
  // The earlier renderRoles created cards without onclick hooking to openBuy; call it here to ensure
  // (renderRoles already did, but ensure consistent)
  // No-op: already rendered on init.
</script>
</body>
</html>
